
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Daemon Â· TDEX Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="tdex-daemon.html" />
    
    
    <link rel="prev" href="provider.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Trader</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="trader.html">
            
                <a href="trader.html">
            
                    
                    Get started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="tdex-cli.html">
            
                <a href="tdex-cli.html">
            
                    
                    CLI
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="tdex-cli.html">
            
                <a href="tdex-cli.html#install">
            
                    
                    Install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="tdex-cli.html">
            
                <a href="tdex-cli.html#commands">
            
                    
                    Commands
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="tdex-sdk.html">
            
                <a href="tdex-sdk.html">
            
                    
                    JavaScript SDK
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="tdex-sdk.html">
            
                <a href="tdex-sdk.html#trade">
            
                    
                    Trade
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="tdex-sdk.html">
            
                <a href="tdex-sdk.html#identity">
            
                    
                    Identity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="tdex-sdk.html">
            
                <a href="tdex-sdk.html#swap">
            
                    
                    Swap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" >
            
                <span>
            
                    
                    Mobile App (Coming soon)
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">Liquidity Provider</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="provider.html">
            
                <a href="provider.html">
            
                    
                    Get started
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.2" data-path="tdex-daemon.html">
            
                <a href="tdex-daemon.html">
            
                    
                    Daemon
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="tdex-daemon.html">
            
                <a href="tdex-daemon.html#overview">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="tdex-daemon.html">
            
                <a href="tdex-daemon.html#data-directory">
            
                    
                    Data Directory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="tdex-daemon.html">
            
                <a href="tdex-daemon.html#run-with-docker">
            
                    
                    Run with Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="tdex-daemon.html">
            
                <a href="tdex-daemon.html#run-standalone">
            
                    
                    Run standalone
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.5" data-path="tdex-daemon.html">
            
                <a href="tdex-daemon.html#environment-variables">
            
                    
                    Environment variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.6" data-path="tdex-daemon.html">
            
                <a href="tdex-daemon.html#deposit-funds">
            
                    
                    Deposit funds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.7" data-path="tdex-daemon.html">
            
                <a href="tdex-daemon.html#manage-markets">
            
                    
                    Manage markets
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Daemon</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="tdex-daemon">TDEX Daemon</h1>
<p>Daemon implementation to execute automated market marking strategies on top of TDEX</p>
<h2 id="overview">Overview</h2>
<p>The daemon exposes two HTTP/2 gRPC interfaces, one meant to be public to be consumed by traders that fully implements <a href="https://github.com/tdex-network/tdex-specs/blob/master/04-trade-protocol.md" target="_blank">BOTD #4</a> called <strong>trader interface</strong> (by default on the port <strong>9945</strong>) and another private to be consumed by the liquidity provider for internal management called <strong>operator interface</strong> by default on the port <strong>9000</strong>). </p>
<p>The daemon has an embedded Liquid wallet and sources blockchain information via a block explorer, at the time of writing, it supports only the <a href="https://github.com/blockstream/electrs" target="_blank">Blockstream fork of Electrs</a>. By default the daemon connects to <a href="https://blockstream.info/liquid/api/" target="_blank">Blockstream.info</a></p>
<p><strong>Operator API</strong></p>
<p>The API for the operator interface are documented <a href="https://github.com/TDex-network/tdex-protobuf/blob/beta/docs/docs.md#operator" target="_blank">here</a></p>
<h2 id="data-directory">Data directory</h2>
<p>The first time you run the daemon, it creates a <strong>data directory</strong> in <code>~/.tdex-daemon</code> and it is used to persist the wallet and the state in an embedded database. 
It&apos;s possible to use a different path for the data directory exporting the environment variable <code>TDEX_DATA_DIR_PATH</code>. If you use docker you must mount the volume pointing to the different chosen path.</p>
<p><strong>Be sure to replicate this data directory to keep your markets running in case of hardware failures. You can restore the access of your funds and the markets with your mnemonic seed</strong></p>
<h2 id="run">Run</h2>
<p>Use one of the following methods to run a TDEX daemon on your machine:</p>
<ul>
<li><a href="#run-with-docker">Docker</a></li>
<li><a href="#run-standalone">Standalone</a></li>
</ul>
<h2 id="run-with-docker">Run with Docker</h2>
<h4 id="pull-from-github-packages">Pull from Github Packages</h4>
<pre><code class="lang-sh">$ docker pull ghcr.io/tdex-network/tdexd:latest
</code></pre>
<h4 id="start-the-daemon">Start the daemon</h4>
<pre><code class="lang-sh"><span class="hljs-comment"># Run on Liquid network connecting to blockstream.info for sourcing blockchain data</span>
$ docker run -it <span class="hljs-_">-d</span> --name tdexd --restart unless-stopped -p 9945:9945 -p 9000:9000 -v `<span class="hljs-built_in">pwd</span>`/tdexd:/.tdex-daemon ghcr.io/tdex-network/tdexd:latest

<span class="hljs-comment"># Run on Liquid connecting to a local explorer</span>
$ docker run -it <span class="hljs-_">-d</span> --name tdexd --restart unless-stopped -p 9945:9945 -p 9000:9000 -v `<span class="hljs-built_in">pwd</span>`/tdexd:/.tdex-daemon <span class="hljs-_">-e</span> TDEX_EXPLORER_ENDPOINT=<span class="hljs-string">&quot;http://127.0.0.1:3001&quot;</span> ghcr.io/tdex-network/tdexd:latest

<span class="hljs-comment"># Run on Regtest connecting to a local explorer and using regtest LBTC asset hash.</span>
$ docker run -it <span class="hljs-_">-d</span> --name tdexd --restart unless-stopped -p 9945:9945 -p 9000:9000 -v `<span class="hljs-built_in">pwd</span>`/tdexd:/.tdex-daemon <span class="hljs-_">-e</span> TDEX_NETWORK=<span class="hljs-string">&quot;regtest&quot;</span> <span class="hljs-_">-e</span> TDEX_BASE_ASSET=<span class="hljs-string">&quot;5ac9f65c0efcc4775e0baec4ec03abdde22473cd3cf33c0419ca290e0751b225&quot;</span> <span class="hljs-_">-e</span> TDEX_EXPLORER_ENDPOINT=<span class="hljs-string">&quot;http://127.0.0.1:3001&quot;</span>  ghcr.io/tdex-network/tdexd:latest

<span class="hljs-comment"># Run on Liquid and specify USDt as base asset instead of default L-BTC</span>
$ docker run -it <span class="hljs-_">-d</span> --name tdexd --restart unless-stopped -p 9945:9945 -p 9000:9000 -v `<span class="hljs-built_in">pwd</span>`/tdexd:/.tdex-daemon <span class="hljs-_">-e</span> TDEX_BASE_ASSET=<span class="hljs-string">&quot;ce091c998b83c78bb71a632313ba3760f1763d9cfcffae02258ffa9865a37bd2&quot;</span> ghcr.io/tdex-network/tdexd:latest
</code></pre>
<p>This will mount the data direcory in a folder called <code>tdexd</code> in your current path.</p>
<p>See <a href="#environment-variables">Enviroment Variables</a> for all available options. </p>
<h3 id="check-the-logs">Check the Logs</h3>
<pre><code class="lang-sh">$ docker logs tdex
INFO[0000] trader interface is listening on :9945
INFO[0000] operator interface is listening on :9945
</code></pre>
<h3 id="use-the-operator-cli">Use the operator CLI</h3>
<pre><code class="lang-sh">$ <span class="hljs-built_in">alias</span> tdex=<span class="hljs-string">&apos;docker exec -it tdexd tdex&apos;</span>
</code></pre>
<p>Now you are ready to <a href="#deposit-funds">deposit funds</a> to create your first market and start accepting incoming trades. </p>
<h2 id="run-standalone">Run standalone</h2>
<h4 id="install">Install</h4>
<ol>
<li><p><a href="https://github.com/tdex-network/tdex-daemon/releases" target="_blank">Download the latest release for MacOS or Linux</a></p>
</li>
<li><p>Move daemon and cli into a folder in your PATH (eg. <code>/usr/local/bin</code>) and rename the daemon as <code>tdexd</code> and the cli as <code>tdex</code></p>
</li>
<li><p>Give executable permissions. (eg. <code>chmod a+x /usr/local/bin/tdexd</code> and <code>chmod a+x /usr/local/bin/tdex</code>)</p>
</li>
</ol>
<h4 id="run">Run</h4>
<pre><code class="lang-sh"><span class="hljs-comment"># Run on Liquid network connecting to blockstream.info for sourcing blockchain data</span>
$ tdexd

<span class="hljs-comment"># Run on Liquid connecting to a local explorer</span>
$ <span class="hljs-built_in">export</span> TDEX_EXPLORER_ENDPOINT=<span class="hljs-string">&quot;http://127.0.0.1:3001&quot;</span>
$ tdexd 

<span class="hljs-comment"># Run on Regtest connecting to a local explorer and using regtest LBTC asset hash.</span>
$ <span class="hljs-built_in">export</span> TDEX_NETWORK=<span class="hljs-string">&quot;regtest&quot;</span> 
$ <span class="hljs-built_in">export</span> TDEX_BASE_ASSET=<span class="hljs-string">&quot;5ac9f65c0efcc4775e0baec4ec03abdde22473cd3cf33c0419ca290e0751b225&quot;</span>
$ <span class="hljs-built_in">export</span> TDEX_EXPLORER_ENDPOINT=<span class="hljs-string">&quot;http://127.0.0.1:3001&quot;</span>
$ tdexd

<span class="hljs-comment"># Run on Liquid and specify USDt as base asset instead of default L-BTC</span>
$ <span class="hljs-built_in">export</span> TDEX_BASE_ASSET=<span class="hljs-string">&quot;ce091c998b83c78bb71a632313ba3760f1763d9cfcffae02258ffa9865a37bd2&quot;</span>
$ tdexd
</code></pre>
<p>This will mount the data direcory in a folder called <code>.tdex-daemon</code> in your <code>$HOME</code>.</p>
<p>See <a href="#environment-variables">Enviroment Variables</a> for all available options. </p>
<h3 id="use-the-operator-cli">Use the operator CLI</h3>
<pre><code class="lang-sh">$ tdex --help
</code></pre>
<p>Now you are ready to <a href="#deposit-funds">deposit funds</a> to create your first market and start accepting incoming trades. </p>
<h2 id="environment-variables">Environment variables</h2>
<p>The list of avialble variables can be found <a href="https://pkg.go.dev/github.com/tdex-network/tdex-daemon/config" target="_blank">here</a></p>
<h2 id="deposit-funds">Deposit funds</h2>
<p>To start a market, you need to deposit two reserves of two <strong>Liquid assets</strong> for the pair (called <strong>Market</strong>) you are providing liquidity for. Each <strong>Market</strong> has a BASE ASSET, wich is always the same per daemon, and a QUOTE ASSET.</p>
<p>To determine the spot price you can adopt different startegies, at the moment the supported one are <strong>PLUGGABLE</strong> and <strong>BALANCED</strong>. </p>
<p>The PLUGGABLE strategy expects you to update the price manually, plugging in an external price feed that need to call the <code>UpdateMarketPrice</code> rpc method of the operator interface. </p>
<p>The BALANCED strategy (this is the default when you create a market) uses <strong>Automated Market Making</strong> to determine the spot price. The initial ratio of the two amounts you deposit will represent the price of the first trade you accept in.
From that point on, the <strong>automated market making strategy will self regulate the trading price</strong>. It follows the <em>constant product market-making</em> formula. Every transaction that occurs on this market will adjust the prices of the market accordingly. It&apos;s a basic supply and demand automated market making system.</p>
<p>The following commands will uses the operator cli <code>tdex</code> to call the gRPC <strong>operator</strong> interface of <code>tdexd</code>. By default running on localhost on port 9000.</p>
<ul>
<li>Initialize the local state of the CLI.</li>
</ul>
<pre><code class="lang-sh"><span class="hljs-comment"># By default it looks for the daemon operator gRPC interface on localhost:9000</span>
$ tdex config init
<span class="hljs-comment"># If the daemon is running on regtest</span>
$ tdex config init --network regtest 
<span class="hljs-comment"># or on a remote machine</span>
$ tdex config init --rpcserver example.com:9000
</code></pre>
<ul>
<li>You can always check the current state with the following command</li>
</ul>
<pre><code class="lang-sh">$ tdex config
</code></pre>
<ul>
<li>Create a new mnemonic seed (only the first time)</li>
</ul>
<pre><code class="lang-sh">$ tdex genseed
</code></pre>
<ul>
<li>Initialize the wallet (only the first time or after a restore from seed)</li>
</ul>
<pre><code class="lang-sh">$ tdex init --seed &lt;generatedSeed&gt; --password &lt;mypassword&gt;
</code></pre>
<ul>
<li>Unlock the wallet with chosen password</li>
</ul>
<pre><code class="lang-sh">$ tdex unlock --password &lt;mypassword&gt;
</code></pre>
<ul>
<li>Get a deposit address from the fee account </li>
</ul>
<pre><code>$ tdex depositfee
</code></pre><p>Now send some L-BTC that will be used to subsidize liquid network fees. </p>
<ul>
<li>Create a Market and get a new deposit address.</li>
</ul>
<pre><code class="lang-sh">$ tdex depositmarket
</code></pre>
<p>Now send some base asset (by default is LBTC) and quote asset of choice in that address, such as USDt or LCAD</p>
<ul>
<li>You can check the status of the market</li>
</ul>
<pre><code class="lang-sh">$ tdex listmarket
</code></pre>
<ul>
<li>Optional: You can get a new deposit address for an already created and funded market passing the optional flag</li>
</ul>
<pre><code class="lang-sh">$ tdex depositmarket --base_asset &lt;BaseAssetHash&gt; --quote_asset &lt;QuoteAssetHash&gt;
</code></pre>
<h2 id="manage-markets">Manage markets</h2>
<ul>
<li>Select the market</li>
</ul>
<pre><code class="lang-sh">$ tdex config <span class="hljs-built_in">set</span> base_asset &lt;BaseAssetHash&gt; 
$ tdex config <span class="hljs-built_in">set</span> quote_asset &lt;QuoteAssetHash&gt;
</code></pre>
<p>You can always check the current state with the following command</p>
<pre><code class="lang-sh">$ tdex config
</code></pre>
<p>Now the following commands will be launch against this market.</p>
<ul>
<li>Open the market using automated market making</li>
</ul>
<pre><code class="lang-sh">$ tdex open
</code></pre>
<p>This makes the selected market availale for trading using the BALANCED market strategy </p>
<ul>
<li>Close the market</li>
</ul>
<pre><code class="lang-sh">$ tdex close
</code></pre>
<p>This makes the selected market NOT availale for trading.</p>
<ul>
<li>Change market making strategy to pluggable</li>
</ul>
<pre><code class="lang-sh">$ tdex strategy --pluggable
</code></pre>
<ul>
<li>Update the price</li>
</ul>
<pre><code class="lang-sh">$ tdex price --base_price=16000 --quote-price=0.001
</code></pre>
<p>This updates the current market price to be used for future trades.</p>
<ul>
<li>Open the market again</li>
</ul>
<pre><code class="lang-sh">$ tdex open
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="provider.html" class="navigation navigation-prev " aria-label="Previous page: Get started">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="tdex-daemon.html#overview" class="navigation navigation-next " aria-label="Next page: Overview">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Daemon","level":"3.2","depth":1,"next":{"title":"Overview","level":"3.2.1","depth":2,"anchor":"#overview","path":"tdex-daemon.md","ref":"tdex-daemon.md#overview","articles":[]},"previous":{"title":"Get started","level":"3.1","depth":1,"path":"provider.md","ref":"provider.md","articles":[]},"dir":"ltr"},"config":{"plugins":["folding-menu","insert-logo"],"styles":{"website":"./styles/website.css"},"pluginsConfig":{"insert-logo":{"url":"./tdex-logo.png","style":"background: none; height:64px"},"folding-menu":{"animationDuration":400,"sticky":false},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"TDEX Documentation","gitbook":"*"},"file":{"path":"tdex-daemon.md","mtime":"2020-11-27T10:57:37.439Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-11-27T10:58:50.329Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-folding-menu/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

